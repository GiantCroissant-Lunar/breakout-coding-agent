name: Assign Copilot to Game-RFC Issues

on:
  issues:
    types: [opened, reopened, labeled, edited]

permissions:
  issues: write

jobs:
  assign:
    if: |
      contains(github.event.issue.title, 'Game-RFC-') ||
      contains(join(github.event.issue.labels.*.name, ','), 'game-rfc')
    runs-on: ubuntu-latest
    steps:
    - name: Ensure Copilot is assigned
      run: |
        ISSUE=${{ github.event.issue.number }}
        REPO=${{ github.repository }}
        echo "Checking assignment for issue #$ISSUE"
        ASSIGNEES=$(gh issue view "$ISSUE" --repo "$REPO" --json assignees --jq '.assignees[].login' || true)
        if ! echo "$ASSIGNEES" | grep -Eq '^(copilot-swe-agent|Copilot)$'; then
          echo "Assigning GitHub Coding Agent to #$ISSUE"
          gh issue edit "$ISSUE" --repo "$REPO" --add-assignee copilot-swe-agent \
            || gh issue edit "$ISSUE" --repo "$REPO" --add-assignee Copilot \
            || echo "Warning: could not assign Coding Agent (copilot-swe-agent/Copilot)"
        else
          echo "copilot-swe-agent already assigned"
        fi
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
